<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hielectro.welpair.inventory.model.dao.InventoryDAO">

    <!-- 1-2 -->
    <resultMap type="com.hielectro.welpair.inventory.model.dto.ProductDTO" id="searchInvenResultMap">
        <id property="productCode" column="PRODUCT_CODE"/>
        <result property="productName" column="PRODUCT_NAME"/>
        <result property="productAmount" column="PRODUCT_AMOUNT"/>
        <association property="category" resultMap="categoryDTO"/>
    </resultMap>

    <resultMap id="categoryDTO" type="com.hielectro.welpair.inventory.model.dto.CategoryDTO">
        <id property="categoryCode" column="CATEGORY_CODE"/>
        <result property="categoryName" column="CATEGORY_NAME"/>
    </resultMap>

    <!-- 2-1 -->
    <resultMap type="com.hielectro.welpair.inventory.model.dto.ProductDTO" id="stockRegistSerchResultMap">
        <id property="productCode" column="PRODUCT_CODE"/>
        <result property="productName" column="PRODUCT_NAME"/>
        <association property="category" resultMap="categoryDTO"/>
    </resultMap>


    <!--  -->
    <resultMap type="com.hielectro.welpair.inventory.model.dto.StockDTO" id="stockResultMap">
        <id property="productCode" column="PRODUCT_CODE"/>
        <result property="productName" column="PRODUCT_NAME"/>
        <result property="stockType" column="STOCK_TYPE"/>
        <result property="stockDate" column="STOCK_DATE"/>
        <result property="stockAmount" column="STOCK_AMOUNT"/>
        <result property="productAmount" column="STOCK_TYPE"/>
        <association property="productCode" javaType="com.hielectro.welpair.inventory.model.dto.ProductDTO">
            <result property="productAmount" column="PRODUCT_AMOUNT"/>
        </association>
    </resultMap>



    <!-- 1-1 -->
    <select id="getTotalInventoryAmount" resultType="_int">
        SELECT
               SUM(PRODUCT_AMOUNT) AS 총재고수량
          FROM T_PRODUCT
    </select>

    <select id="getNumberOfAlertStock" resultType="_int">
        SELECT
               COUNT(*) AS 위험재고수량
          FROM T_PRODUCT
         WHERE PRODUCT_AMOUNT &lt; 10

    </select>

    <!-- 1-2 -->
    <select id="searchProductByCode" resultMap="searchInvenResultMap">
        SELECT
               A.PRODUCT_CODE
             , A.PRODUCT_NAME
             , B.CATEGORY_NAME
             , A.PRODUCT_AMOUNT
         FROM T_PRODUCT A
         JOIN T_CATEGORY B ON B.CATEGORY_CODE = A.CATEGORY_CODE
         <if test=" searchCode != null">
        WHERE A.PRODUCT_CODE = #{ searchCode }
         </if>
    </select>


<!-- 2-1. -->

    <select id="stockRegistSerch" resultMap="stockRegistSerchResultMap">
        SELECT
               A.PRODUCT_CODE
             , A.PRODUCT_NAME
             , B.CATEGORY_NAME
          FROM T_PRODUCT A
          JOIN T_CATEGORY B ON B.CATEGORY_CODE = A.CATEGORY_CODE
         WHERE 1=1
        <if test="productCode != null and productCode != ''">
            AND A.PRODUCT_CODE = #{productCode}
        </if>
        <if test="productName != null and productName != ''">
            AND A.PRODUCT_NAME = #{productName}
        </if>
        <if test="categoryCode != null and categoryCode != ''">
            AND A.CATEGORY_CODE = #{categoryCode}
        </if>
    </select>




</mapper>