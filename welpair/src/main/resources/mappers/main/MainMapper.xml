<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hielectro.welpair.main.model.dao.MainMapper">
    <resultMap id="SellProductResultMap" type="com.hielectro.welpair.sellproduct.model.dto.SellProductDTO">
        <id property="id" column="SELL_PRODUCT_ID"/>
        <result property="code" column="PRODUCT_CODE"/>
        <result property="discount" column="DISCOUNT"/>
        <result property="isSell" column="IS_SELL"/>

        <association property="product" resultMap="ProductDTO"/>
        <association property="sellItemPage" resultMap="SellItemPageDTO"/>
    </resultMap>

    <resultMap id="ProductDTO" type="com.hielectro.welpair.inventory.model.dto.ProductDTO">
        <id property="productCode" column="PRODUCT_CODE"/>
        <result property="productName" column="PRODUCT_NAME"/>
        <result property="productStatus" column="PRODUCT_STATUS"/>
        <result property="productPrice" column="PRODUCT_PRICE"/>
        <result property="productOption" column="PRODUCT_OPTION"/>
        <result property="categoryCode" column="CATEGORY_CODE"/>
    </resultMap>

    <resultMap id="SellItemPageDTO" type="com.hielectro.welpair.sellproduct.model.dto.SellItemPageDTO">
        <id property="no" column="SELL_PAGE_NO"/>
        <id property="id" column="SELL_PRODUCT_ID"/>

        <association property="sellPage" resultMap="SellPageDTO"/>
    </resultMap>

    <resultMap id="SellPageDTO" type="com.hielectro.welpair.sellproduct.model.dto.SellPageDTO">
        <id property="no" column="SELL_PAGE_NO"/>
        <result property="title" column="SELL_PAGE_TITLE"/>
        <result property="detailImageFileName" column="SELL_DETAIL_IMAGE_FILE_NAME"/>
        <result property="detailImageOriginFileName" column="SELL_DETAIL_IMAGE_ORGIN_FILE_NAME"/>
        <result property="path" column="FILE_PATH"/>
        <result property="createDate" column="CREATE_DATE"/>

        <collection property="thumbnailImageList" resultMap="ThumbnailImageDTO"/>
    </resultMap>

    <resultMap id="CategoryDTO" type="com.hielectro.welpair.inventory.model.dto.CategoryDTO">
        <id property="categoryCode" column="CATEGORY_CODE"/>
        <result property="categoryName" column="CATEGORY_NAME"/>
        <result property="refCategoryCode" column="REF_CATEGORY_CODE"/>
        <association property="refCategory" resultMap="CategoryDTO"/>
    </resultMap>

    <resultMap id="ThumbnailImageDTO" type="com.hielectro.welpair.sellproduct.model.dto.ThumbnailImageDTO">
        <id property="no" column="SELL_PAGE_NO"/>
        <result property="thumbnailImageFileName" column="SELL_THUMB_IMAGE_FILE_NAME"/>
        <result property="thumbnailImageOriginFileName" column="SELL_THUMB_IMAGE_ORGIN_FILE_NAME"/>
    </resultMap>

    <select id="selectOneSellProduct" resultMap="SellProductResultMap">
        SELECT
        *
        FROM T_SELL_PRODUCT
        JOIN T_PRODUCT USING (PRODUCT_CODE)
        JOIN T_CATEGORY A USING (CATEGORY_CODE)
        JOIN T_CATEGORY B ON (B.CATEGORY_CODE = A.REF_CATEGORY_CODE)
        JOIN T_SELL_ITEM_PAGE USING (SELL_PRODUCT_ID)
        JOIN T_SELL_PAGE USING (SELL_PAGE_NO)
        JOIN T_THUMB_IMAGE USING (SELL_PAGE_NO)
        WHERE 1=1
        <if test="pageNo != null and pageNo != ''">
            AND SELL_PAGE_NO = #{ pageNo }
        </if>
    </select>
</mapper>