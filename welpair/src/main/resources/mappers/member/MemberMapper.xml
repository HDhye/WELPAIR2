<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hielectro.welpair.member.model.dao.MemberMapper">

    <resultMap type="com.hielectro.welpair.member.model.dto.MemberDTO" id="memberResultMap">
        <id property="empNo" column="EMP_NO"/>
        <result property="memPwd" column="MEM_PWD"/>
        <result property="registDate" column="REGIST_DATE"/>
        <result property="pointBalance" column="POINT_BALANCE"/>
        <result property="memAuth" column="MEM_AUTH"/>
    </resultMap>
    <select id="checkoutMemberById" resultMap="memberResultMap">
        SELECT * FROM T_MEMBER
        WHERE EMP_NO = #{empNo}
    </select>


    <!-- 1-1. 회원조회 - 회원목록 -->
<!--    <resultMap id="memberListResultMap" type="com.hielectro.welpair.member.model.dto.MemberDTO">-->
<!--        <id property="empNo" column="EMP_NO"/>-->
<!--        <result property="memPwd" column="MEM_PWD"/>-->
<!--        <result property="registDate" column="REGIST_DATE"/>-->
<!--        <result property="pointBalance" column="POINT_BALANCE"/>-->
<!--        <result property="memAuth" column="MEM_AUTH"/>-->
<!--        <association property="employee" resultMap="employeeListResultMap"/>-->
<!--    </resultMap>-->
<!--    <resultMap id="employeeListResultMap" type="com.hielectro.welpair.member.model.dto.EmployeeDTO">-->
<!--        <id property="empNo" column="EMP_NO"/>-->
<!--        <result property="empName" column="EMP_NAME"/>-->
<!--        <result property="empEmail" column="EMP_EMAIL"/>-->
<!--        <result property="empPhone" column="EMP_PHONE"/>-->
<!--    </resultMap>-->

<!-- 위와 같은 결과  ( 위는 분리하여관리, 재상용 용이 / 아래는 가독성 )-->
    <resultMap id="memberListResultMap" type="com.hielectro.welpair.member.model.dto.MemberDTO">
        <id property="empNo" column="EMP_NO"/>
        <result property="memPwd" column="MEM_PWD"/>
        <result property="registDate" column="REGIST_DATE"/>
        <result property="pointBalance" column="POINT_BALANCE"/>
        <result property="memAuth" column="MEM_AUTH"/>
        <association property="employee" javaType="com.hielectro.welpair.member.model.dto.EmployeeDTO">
            <result property="empNo" column="EMP_NO"/>
            <result property="empName" column="EMP_NAME"/>
            <result property="empEmail" column="EMP_EMAIL"/>
            <result property="empPhone" column="EMP_PHONE"/>
            <result property="isExpire" column="IS_EXPIRE"/>
        </association>
    </resultMap>

    <resultMap id="employeeListResultMap" type="com.hielectro.welpair.member.model.dto.EmployeeDTO">
        <id property="empNo" column="EMP_NO"/>
        <result property="hireDate" column="HIRE_DATE"/>
        <result property="empName" column="EMP_NAME"/>
        <result property="empEmail" column="EMP_EMAIL"/>
        <result property="empPhone" column="EMP_PHONE"/>
        <result property="empDept" column="EMP_DEPT"/>
        <result property="jobCode" column="JOB_CODE"/>
        <result property="isExpire" column="IS_EXPIRE"/>
    </resultMap>


<!-- 1. 페이징처리하여 보여줄 회원목록-->
    <select id="getMemberList" resultMap="memberListResultMap">
        SELECT *
        FROM (SELECT rownum AS rnum
                   , M.EMP_NO
                   , M.MEM_PWD
                   , M.REGIST_DATE
                   , M.POINT_BALANCE
                   , M.MEM_AUTH
                   , E.EMP_NAME
                   , E.EMP_EMAIL
                   , E.EMP_PHONE
                   , E.IS_EXPIRE
              FROM T_MEMBER M
              JOIN T_EMPLOYEE E ON (M.EMP_NO = E.EMP_NO)
              <if test='isExpired != null and isExpired.equals("Y")'>
              WHERE E.IS_EXPIRE = 'Y'
              ORDER BY M.EMP_NO
              </if>
              )
        WHERE rnum BETWEEN #{startRow} AND #{endRow}
    </select>


<!-- 전체회원수, 퇴사회원수 조회 -->
    <select id="totalMemberCount" resultType="_int" parameterType="hashmap">
        SELECT
                COUNT(*)
          FROM T_MEMBER M
    </select>
    <select id="expiredMemberCount" resultType="_int" parameterType="hashmap">
        SELECT COUNT(*)
        FROM T_MEMBER M
                 JOIN T_EMPLOYEE E on M.EMP_NO = E.EMP_NO
        WHERE E.IS_EXPIRE = 'Y'
    </select>
    
    
<!-- 계정 삭제 -->
    <delete id="deleteMember" parameterType="String">
        DELETE
        FROM T_MEMBER M
        WHERE M.EMP_NO = #{empNo}
    </delete>


<!--  2. 회원등록  -->
    <select id="getEmployeeList" resultMap="employeeListResultMap">
        select * from
            (select
                 rownum AS rnum
                  ,E.EMP_NO
                  ,E.EMP_NAME
                  ,E.EMP_EMAIL
                  ,E.EMP_PHONE
                  ,E.EMP_DEPT
                  ,E.JOB_CODE
                  ,E.HIRE_DATE
                  ,M.REGIST_DATE
             from T_EMPLOYEE E
                      join T_MEMBER M ON (E.EMP_NO = M.EMP_NO)
             where E.IS_EXPIRE = 'N' and E.EMP_NO like 'E%'
             order by E.HIRE_DATE desc)
        WHERE rnum BETWEEN #{startRow} AND #{endRow}
    </select>

    <select id="totalEmployeeCount" resultType="_int" parameterType="hashmap">
        SELECT
            COUNT(*)
        FROM T_EMPLOYEE E
    </select>



</mapper>