<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hielectro.welpair.delivery.model.dao.deliveryMapper">


    <!-- 배송관련 deliveryDTO -->
    <resultMap id="deliveryDTO" type="com.hielectro.welpair.delivery.model.dto.DeliveryDTO">
        <id property="productOrderNo" column="PRODUCT_ORDER_NO"/>
        <result property="driverId" column="DRIVER_ID"/>
        <result property="deliveryStatus" column="DELIVERY_STATUS"/>

        <association property="productByOrder" resultMap="productByOrderDTO"/>
    </resultMap>

    <resultMap id="productByOrderDTO" type="com.hielectro.welpair.delivery.model.dto.ProductByOrderDTO">
        <id property="productOrderNo" column="PRODUCT_ORDER_NO"/>
        <result property="orderNo" column="ORDER_NO"/>
        <result property="sellProductId" column="SELL_PRODUCT_ID"/>
        <result property="amount" column="PRODUCT_ORDER_AMOUNT"/>
        <result property="orderPrice" column="PRODUCT_ORDER_PRICE"/>
        <result property="deliveryDate" column="DELIVERY_DATE"/>
    </resultMap>


    <!-- deliveryStockDTO -->
    <!--    <resultMap id="deliveryStockDTO" type="com.hielectro.welpair.delivery.model.dto.DeliveryStockDTO">-->
    <!--        <id property="stockNo" column="STOCK_NO"/>-->
    <!--        <result property="productOrderNo" column="PRODUCT_ORDER_NO"/>-->
    <!--    </resultMap>-->

    <!-- 배송기사 driverDTO -->
    <resultMap id="driverDTO" type="com.hielectro.welpair.delivery.model.dto.DriverDTO">
        <id property="driverId" column="DRIVER_ID"/>
        <result property="driverName" column="DRIVER_NAME"/>
        <result property="driverPhone" column="DRIVER_PHONE"/>

        <!-- 2. DriverDTO에서 담지 못하는 정보에 대해 담을 수 있는 객체를 지정 -->
        <!-- List 형식으로 받을 것이기 때문에 collection 이용
             1대 1일 경우에는 association 이용
        -->
        <collection property="delivery" resultMap="deliveryDTO"/>
    </resultMap>


    <!-- 배송조회에서 주문번호로조회 할 수 있게 DELIVERY + PRODUCT_ORDER JOIN -->
    <select id="deliveryDelivery" resultMap="deliveryDTO">
        SELECT TE.PRODUCT_ORDER_NO
             , TE.DRIVER_ID
             , TE.DELIVERY_STATUS
             , PO.PRODUCT_ORDER_NO
             , PO.ORDER_NO
             , PO.SELL_PRODUCT_ID
             , PO.PRODUCT_ORDER_AMOUNT
             , PO.PRODUCT_ORDER_PRICE
             , PO.DELIVERY_DATE
        FROM T_DELIVERY TE
                 JOIN T_PRODUCT_ORDER PO
                      ON TE.PRODUCT_ORDER_NO = PO.PRODUCT_ORDER_NO
    </select>

    <!-- DRIVER + DELIVERY JOIN -->
    <select id="deliveryDriver" resultMap="driverDTO">
        SELECT TR.DRIVER_ID
             , TR.DRIVER_NAME
             , TR.DRIVER_PHONE
             , TE.PRODUCT_ORDER_NO
             , TE.DRIVER_ID
             , TE.DELIVERY_STATUS
        FROM T_DRIVER TR
        JOIN T_DELIVERY TE
          ON TR.DRIVER_ID = TE.DRIVER_ID
    </select>

    <!-- 3조인 ORDER + PRODUCT_ORDER JOIN + DELIVERY __1 -->
    <select id="orderProduct" resultMap="deliveryDTO">
        SELECT TR.ORDER_NO
             , TR.ORDER_DATE
             , TR.TOTAL_PRICE
             , TR.DELIVERY_TYPE
             , TR.EMP_NO
             , PO.ORDER_NO
             , PO.PRODUCT_ORDER_NO
             , PO.SELL_PRODUCT_ID
             , PO.PRODUCT_ORDER_AMOUNT
             , PO.PRODUCT_ORDER_PRICE
             , PO.DELIVERY_DATE
          FROM T_ORDER TR
          JOIN T_PRODUCT_ORDER PO
            ON TR.ORDER_NO = PO.ORDER_NO
    </select>

    <!-- 3조인 ORDER + PRODUCT_ORDER JOIN + DELIVERY __2 -->
    <select id="orderProductDelivery" resultMap="deliveryDTO">
        SELECT    PO.ORDER_NO
                , PO.PRODUCT_ORDER_NO
                , PO.SELL_PRODUCT_ID
                , PO.PRODUCT_ORDER_AMOUNT
                , PO.PRODUCT_ORDER_PRICE
                , PO.DELIVERY_DATE
                , TD.PRODUCT_ORDER_NO
                , TD.DRIVER_ID
                , TD.DELIVERY_STATUS
          FROM T_PRODUCT_ORDER PO
          JOIN T_DELIVERY TD
            ON PO.PRODUCT_ORDER_NO = TD.PRODUCT_ORDER_NO
    </select>

    <!-- -->



</mapper>
